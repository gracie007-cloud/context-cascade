digraph GeneralResearchWorkflow {
    rankdir=TB;
    compound=true;
    node [shape=box, style=filled, fontname="Arial"];
    edge [fontname="Arial"];

    // Start and end
    start [shape=ellipse, label="Start:\nResearch Question", fillcolor=lightgreen];
    end [shape=ellipse, label="Complete:\nFinal Report", fillcolor=green, fontcolor=white];

    // Gate 0: Pre-Flight Check
    subgraph cluster_gate0 {
        label="Gate 0: Pre-Flight Check (5-10 min)";
        fillcolor=lightyellow;
        style=filled;

        check_wiki [label="Search Wikipedia\nfor Topic"];
        wiki_exists [shape=diamond, label="Article\nExists?", fillcolor=yellow];
        proceed_step1 [label="Proceed to\nStep 1", fillcolor=lightgreen];
        fallback [label="Google Scholar\nFallback (10 sources)", fillcolor=orange];
        check_lang [label="Check Language\nAccessibility"];
        gate0_pass [shape=octagon, label="GATE 0:\nâ‰¥1 Viable Source?", fillcolor=lightblue];
        gate0_fail [shape=octagon, label="STOP:\nEscalate to User", fillcolor=red, fontcolor=white];

        check_wiki -> wiki_exists;
        wiki_exists -> proceed_step1 [label="yes"];
        wiki_exists -> fallback [label="no"];
        proceed_step1 -> check_lang;
        fallback -> check_lang;
        check_lang -> gate0_pass;
        gate0_pass -> gate0_fail [label="no", color=red];
    }

    // Step 1: Wikipedia Mining
    subgraph cluster_step1 {
        label="Step 1: Wikipedia Mining (15-30 min)";
        fillcolor=lightblue;
        style=filled;

        read_article [label="Read Wikipedia\nArticle"];
        extract_refs [label="Extract References +\nFurther Reading"];
        categorize [label="Categorize by Type:\nBooks/Papers/News"];
        store_citations [label="Store in Memory MCP\n(WHO/WHEN/PROJECT/WHY)"];
        gate1 [shape=octagon, label="GATE 1:\nâ‰¥10 Citations?", fillcolor=lightblue];
        gate1_fail [shape=octagon, label="Expand to\nRelated Articles", fillcolor=orange];

        read_article -> extract_refs;
        extract_refs -> categorize;
        categorize -> store_citations;
        store_citations -> gate1;
        gate1 -> gate1_fail [label="no", color=orange];
        gate1_fail -> read_article [style=dashed, label="retry"];
    }

    // Step 2: Source Discovery
    subgraph cluster_step2 {
        label="Step 2: Source Discovery (1-2 hours)";
        fillcolor=lightblue;
        style=filled;

        search_catalogs [label="Search WorldCat +\nGoogle Books"];
        classify_access [label="Classify Primary/Secondary\n+ Accessibility"];
        expand_search [label="Expand via Scholar,\nAuthor Works"];
        build_inventory [label="Build Source Inventory\n(20+ sources)"];
        gate2 [shape=octagon, label="GATE 2:\nâ‰¥20 & â‰¥50% Accessible?", fillcolor=lightblue];
        gate2_fail [shape=octagon, label="Continue Discovery\nOR Document Exception", fillcolor=orange];

        search_catalogs -> classify_access;
        classify_access -> expand_search;
        expand_search -> build_inventory;
        build_inventory -> gate2;
        gate2 -> gate2_fail [label="no", color=orange];
        gate2_fail -> expand_search [style=dashed, label="retry"];
    }

    // Step 3: Source Classification
    subgraph cluster_step3 {
        label="Step 3: Source Classification (30-60 min)";
        fillcolor=lightcyan;
        style=filled;

        analyst_classify [label="ANALYST:\nClassify Primary/Secondary", shape=box];
        credibility_rubric [label="Apply Credibility\nRubric (Start 3, Â±1)", fillcolor=lightyellow];
        bias_rubric [label="Apply Bias Risk\nRubric (Start 2, +1)", fillcolor=lightyellow];
        priority_calc [label="Calculate Priority:\n(RelÃ—0.4)+(CredÃ—0.3)+Type+Access"];
        flag_sources [label="Flag:\nðŸ’¡High Priority\nðŸš¨High Bias"];
        gate3 [shape=octagon, label="GATE 3:\nâ‰¥5 Primaries &\nâ‰¥80% Cred â‰¥3?", fillcolor=lightblue];
        gate3_exception [shape=octagon, label="Exception:\nNo Primaries Available?", fillcolor=yellow];
        gate3_fail [shape=octagon, label="Return to\nStep 2", fillcolor=orange];

        analyst_classify -> credibility_rubric;
        credibility_rubric -> bias_rubric;
        bias_rubric -> priority_calc;
        priority_calc -> flag_sources;
        flag_sources -> gate3;
        gate3 -> gate3_exception [label="no", color=orange];
        gate3_exception -> gate3_fail [label="no exception"];
    }

    // Step 4: Contextual Analysis
    subgraph cluster_step4 {
        label="Step 4: Contextual Analysis (1-2 hours)";
        fillcolor=lightblue;
        style=filled;

        temporal_ctx [label="Temporal Context:\nWhen? Events? Influence?"];
        cultural_ctx [label="Cultural Context:\nBackground? Audience?"];
        historio_ctx [label="Historiographical:\nScholarly Debate?"];
        translation_ctx [label="Translation Issues?\n(If Applicable)", fillcolor=lightyellow];
        create_profiles [label="Create Context Profiles\n(3-5 sentences each)"];
        gate4 [shape=octagon, label="GATE 4:\nâ‰¥10 Sources &\nâ‰¥3 Time Periods?", fillcolor=lightblue];
        gate4_fail [shape=octagon, label="Continue\nAnalysis", fillcolor=orange];

        temporal_ctx -> cultural_ctx;
        cultural_ctx -> historio_ctx;
        historio_ctx -> translation_ctx;
        translation_ctx -> create_profiles;
        create_profiles -> gate4;
        gate4 -> gate4_fail [label="no", color=orange];
        gate4_fail -> temporal_ctx [style=dashed, label="more sources"];
    }

    // Step 5: Note-Taking
    subgraph cluster_step5 {
        label="Step 5: Comprehensive Note-Taking (2-3 hours)";
        fillcolor=lightblue;
        style=filled;

        read_priority [label="Read Priority 4-5\nSources First"];
        capture_claims [label="Capture Key Claims\n(Min 2 per source)"];
        capture_evidence [label="Capture Supporting\nEvidence"];
        capture_quotes [label="Extract Quotable\nPassages + Pages"];
        detect_conflicts [label="Detect Contradictions\nAcross Sources", fillcolor=lightyellow];
        cross_ref [label="Create Cross-Reference\nLinks"];
        tag_notes [label="Tag: #primary #key-claim\n#needs-verification"];
        gate5 [shape=octagon, label="GATE 5:\nâ‰¥50 Notes, â‰¥20 Quotes,\nâ‰¥5 Cross-Links?", fillcolor=lightblue];
        gate5_fail [shape=octagon, label="Re-read Sources\nfor Missed Content", fillcolor=orange];

        read_priority -> capture_claims;
        capture_claims -> capture_evidence;
        capture_evidence -> capture_quotes;
        capture_quotes -> detect_conflicts;
        detect_conflicts -> cross_ref;
        cross_ref -> tag_notes;
        tag_notes -> gate5;
        gate5 -> gate5_fail [label="no", color=orange];
        gate5_fail -> read_priority [style=dashed, label="retry"];
    }

    // Step 6: Synthesis
    subgraph cluster_step6 {
        label="Step 6: Synthesis & Dot Connecting (1-2 hours)";
        fillcolor=lightgreen;
        style=filled;

        // Phase A: Pattern Recognition
        subgraph cluster_phase_a {
            label="Phase A: Pattern Recognition (Researcher)";
            fillcolor=lightyellow;
            style=filled;

            review_notes [label="Review ALL Notes"];
            find_themes [label="Identify Recurring\nThemes (â‰¥3 sources)"];
            find_agreements [label="Find Agreements"];
            find_conflicts [label="Find Contradictions"];
            map_chains [label="Map Evidence Chains:\nAâ†’Bâ†’Claim"];
        }

        // Phase B: Thesis Formation
        subgraph cluster_phase_b {
            label="Phase B: Thesis Formation (Researcher)";
            fillcolor=lightyellow;
            style=filled;

            emerge_thesis [label="Let Thesis EMERGE\n(NOT Imposed)", fillcolor=yellow];
            draft_thesis [label="Draft 1-2 Sentence\nThesis"];
            inconclusive_check [shape=diamond, label="Evidence\nSufficient?", fillcolor=yellow];
            thesis_path [label="List â‰¥5 Supporting\nSources"];
            inconclusive_path [label="State INCONCLUSIVE\n+ Explanation", fillcolor=orange];
            list_limits [label="Identify Limitations"];
        }

        // Phase C: Validation
        subgraph cluster_phase_c {
            label="Phase C: Validation (Analyst)";
            fillcolor=lightcyan;
            style=filled;

            check_fallacies [label="ANALYST: Check\nLogical Fallacies"];
            verify_cites [label="Verify ALL Claims\nHave Citations + Pages"];
            flag_unsupported [label="Flag Unsupported\nAssertions"];
            assess_strength [shape=diamond, label="Argument\nStrength?", fillcolor=yellow];
            strong [label="STRONG:\nâ‰¥5 sources, â‰¥2 primaries", fillcolor=lightgreen];
            weak [label="WEAK:\n<3 sources", fillcolor=lightcoral];
        }

        // Phase D: Final Report
        compile_report [label="COORDINATOR:\nCompile Final Report", fillcolor=lightblue];
        gate6 [shape=octagon, label="GATE 6 (FINAL):\nThesis Supported? No Fallacies?\nâ‰¥2 Primaries? â‰¥1 Limitation?", fillcolor=lightblue];
        gate6_fail [shape=octagon, label="Return to\nPhase B", fillcolor=orange];

        review_notes -> find_themes;
        find_themes -> find_agreements;
        find_agreements -> find_conflicts;
        find_conflicts -> map_chains;
        map_chains -> emerge_thesis;
        emerge_thesis -> draft_thesis;
        draft_thesis -> inconclusive_check;
        inconclusive_check -> thesis_path [label="yes"];
        inconclusive_check -> inconclusive_path [label="no"];
        thesis_path -> list_limits;
        inconclusive_path -> list_limits;
        list_limits -> check_fallacies;
        check_fallacies -> verify_cites;
        verify_cites -> flag_unsupported;
        flag_unsupported -> assess_strength;
        assess_strength -> strong [label="strong"];
        assess_strength -> weak [label="weak"];
        strong -> compile_report;
        weak -> gate6_fail;
        compile_report -> gate6;
        gate6 -> gate6_fail [label="no", color=red];
        gate6_fail -> emerge_thesis [style=dashed, label="revise"];
    }

    // External references
    memory_mcp [shape=cylinder, label="Memory MCP\n(WHO/WHEN/PROJECT/WHY)", fillcolor=lightcoral];
    red_principles [shape=folder, label="Red's Principles:\nTrust No One\nContext is Everything\nThesis from Evidence", fillcolor=lightsalmon];

    // Main flow
    start -> check_wiki;
    gate0_pass -> read_article [lhead=cluster_step1, label="pass", color=green];
    gate1 -> search_catalogs [lhead=cluster_step2, label="pass", color=green];
    gate2 -> analyst_classify [lhead=cluster_step3, label="pass", color=green];
    gate3 -> temporal_ctx [lhead=cluster_step4, label="pass", color=green];
    gate3_exception -> temporal_ctx [label="doc exception", color=green, style=dashed];
    gate4 -> read_priority [lhead=cluster_step5, label="pass", color=green];
    gate5 -> review_notes [lhead=cluster_step6, label="pass", color=green];
    gate6 -> end [label="pass", color=green];

    // External connections
    store_citations -> memory_mcp [style=dashed, label="stores"];
    build_inventory -> memory_mcp [style=dashed, label="stores"];
    create_profiles -> memory_mcp [style=dashed, label="stores"];
    tag_notes -> memory_mcp [style=dashed, label="stores"];
    compile_report -> memory_mcp [style=dashed, label="stores"];

    emerge_thesis -> red_principles [style=dashed, label="applies"];
    verify_cites -> red_principles [style=dashed, label="applies"];

    labelloc="t";
    label="General Research Workflow - Red's 6-Phase Evidence-Based Methodology\n7 Quality Gates | 3 Agents (researcher, analyst, coordinator) | 6-10 hours";
    fontsize=16;
    fontname="Arial Bold";
}
